{% extends 'base.html' %}

{% block title %}–ü–æ—Å—Ç—Ä–æ–π–∫–∞ –∑–¥–∞–Ω–∏—è - –û—Å—Ç—Ä–æ–≤{% endblock %}

{% block extra_css %}
<style>
    .building-card {
        transition: all 0.3s;
        cursor: pointer;
        border: 2px solid transparent;
        height: 100%;
    }
    .building-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }
    .building-card.selected {
        border-color: #28a745;
        background-color: #f0fff0;
    }
    .building-icon {
        font-size: 48px;
        margin-bottom: 15px;
    }
    .building-price {
        font-size: 1.5rem;
        font-weight: bold;
        color: #28a745;
    }
    .requirements-list {
        list-style: none;
        padding: 0;
        margin: 10px 0;
    }
    .requirements-list li {
        padding: 5px 0;
        border-bottom: 1px dashed #dee2e6;
    }
    .requirements-list li:last-child {
        border-bottom: none;
    }
    .resource-badge {
        background: #e9ecef;
        padding: 3px 8px;
        border-radius: 15px;
        font-size: 0.9rem;
    }
    .construction-time {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px;
        border-radius: 10px;
        text-align: center;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <div class="d-flex justify-content-between align-items-center">
            <h2><i class="bi bi-building"></i> –ü–æ—Å—Ç—Ä–æ–π–∫–∞ –∑–¥–∞–Ω–∏—è</h2>
            <div>
               
                <a href="{% url 'island_dashboard' %}" class="btn btn-sm btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥
                </a>
            </div>
        </div>
        <p class="text-muted">–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö –∑–¥–∞–Ω–∏–π –Ω–∞ –æ—Å—Ç—Ä–æ–≤–µ</p>
    </div>

    <div class="row">
        <!-- –§–æ—Ä–º–∞ –ø–æ—Å—Ç—Ä–æ–π–∫–∏ -->
        <div class="col-md-8 mb-4">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-hammer"></i> –ù–æ–≤–æ–µ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ</h5>
                </div>
                <div class="card-body">
                    <form method="post" id="buildForm" novalidate>
                        {% csrf_token %}
                        <input type="hidden"
                               name="{{ form.building.name }}"
                               id="{{ form.building.id_for_label }}"
                               value="{{ form.building.value|default:'' }}">
                        
                        {% if form.non_field_errors %}
                            <div class="alert alert-danger">
                                {% for error in form.non_field_errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}

                        <!-- –í—ã–±–æ—Ä –∑–¥–∞–Ω–∏—è (–≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏) -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–¥–∞–Ω–∏—è <span class="text-danger">*</span></label>
                            <div class="row" id="buildingCards">
                                {% for building in form.fields.building.queryset %}
                                <div class="col-md-6 mb-3">
                                    <div class="card building-card" data-building-id="{{ building.id }}" 
                                         data-building-name="{{ building.name }}"
                                         data-building-price="{{ building.base_price }}"
                                         data-building-type="{{ building.category }}"
                                         onclick="selectBuilding('{{ building.id }}')">
                                        <div class="card-body text-center">
                                            <div class="building-icon">
                                                {% if 'factory' in building.name|lower %}
                                                    üè≠
                                                {% elif 'shop' in building.name|lower or '–º–∞–≥–∞–∑–∏–Ω' in building.name|lower %}
                                                    üè™
                                                {% elif 'house' in building.name|lower or '–¥–æ–º' in building.name|lower %}
                                                    üè†
                                                {% elif 'warehouse' in building.name|lower or '—Å–∫–ª–∞–¥' in building.name|lower %}
                                                    üì¶
                                                {% elif 'farm' in building.name|lower or '—Ñ–µ—Ä–º–∞' in building.name|lower %}
                                                    üåæ
                                                {% else %}
                                                    üèóÔ∏è
                                                {% endif %}
                                            </div>
                                            <h6>{{ building.name }}</h6>
                                            <div class="building-price">{{ building.base_price }} ‚ÇΩ</div>
                                            <small class="text-muted">{{ building.get_category_display }}</small>
                                            
                                            <!-- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ -->
                                            <div class="mt-2">
                                                <span class="resource-badge">
                                                    <i class="bi bi-arrow-up"></i> +50 –∫ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤—É
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% empty %}
                                <div class="col-12">
                                    <div class="alert alert-warning">
                                        –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–¥–∞–Ω–∏–π –¥–ª—è –ø–æ—Å—Ç—Ä–æ–π–∫–∏. –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç.
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            <input type="hidden" name="{{ form.building.name }}" id="{{ form.building.id_for_label }}" value="{{ form.building.value|default:'' }}">
                            {% if form.building.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.building.errors.0 }}
                                </div>
                            {% endif %}
                        </div>

                        <!-- –ù–æ–º–µ—Ä –∏–≥—Ä–æ–∫–∞ (–≤–ª–∞–¥–µ–ª–µ—Ü) -->
                        <div class="mb-4">
                            <label for="{{ form.player_id.id_for_label }}" class="form-label fw-bold">
                                {{ form.player_id.label }} <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">#</span>
                                <input type="text" 
                                       name="{{ form.player_id.name }}"
                                       id="{{ form.player_id.id_for_label }}"
                                       class="form-control form-control-lg {% if form.player_id.errors %}is-invalid{% endif %}"
                                       value="{{ form.player_id.value|default:'' }}"
                                       placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∏–≥—Ä–æ–∫–∞"
                                       required>
                                <button class="btn btn-outline-secondary" type="button" id="checkPlayerBtn">
                                    <i class="bi bi-search"></i>
                                </button>
                            </div>
                            {% if form.player_id.errors %}
                                <div class="invalid-feedback">
                                    {{ form.player_id.errors.0 }}
                                </div>
                            {% endif %}
                            <div class="form-text" id="playerInfo"></div>
                        </div>

                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–¥–∞–Ω–∏–∏ -->
                        <div class="card bg-light mb-4" id="buildingInfo" style="display: none;">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>–í—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–¥–∞–Ω–∏–µ:</h6>
                                        <h4 id="selectedBuildingName">‚Äî</h4>
                                        <p class="mb-1">–¢–∏–ø: <span id="selectedBuildingType">‚Äî</span></p>
                                        <p class="mb-1">–°—Ç–æ–∏–º–æ—Å—Ç—å: <strong id="selectedBuildingPrice">0</strong> ‚ÇΩ</p>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="construction-time">
                                            <i class="bi bi-clock"></i>
                                            <div class="mt-2">–í—Ä–µ–º—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞: <strong>1 —Ö–æ–¥</strong></div>
                                            <small>–ó–¥–∞–Ω–∏–µ –±—É–¥–µ—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω–æ —Å—Ä–∞–∑—É</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã -->
                        <div class="card mb-4" id="resourcesRequired" style="display: none;">
                            <div class="card-header bg-warning">
                                <h5 class="mb-0"><i class="bi bi-box"></i> –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="text-center">
                                            <i class="bi bi-tree fs-1"></i>
                                            <h6>–î—Ä–µ–≤–µ—Å–∏–Ω–∞</h6>
                                            <span id="woodRequired">100</span> –µ–¥.
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="text-center">
                                            <i class="bi bi-stone fs-1"></i>
                                            <h6>–ö–∞–º–µ–Ω—å</h6>
                                            <span id="stoneRequired">50</span> –µ–¥.
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="text-center">
                                            <i class="bi bi-tools fs-1"></i>
                                            <h6>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h6>
                                            <span id="toolsRequired">20</span> –µ–¥.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å -->
                        <div class="card bg-success text-white mb-4">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-md-6">
                                        <h5 class="mb-0">–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ:</h5>
                                    </div>
                                    <div class="col-md-6">
                                        <h2 class="mb-0 text-end" id="totalCost">0 ‚ÇΩ</h2>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ö–Ω–æ–ø–∫–∏ -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{% url 'island_dashboard' %}" class="btn btn-secondary btn-lg me-md-2">
                                <i class="bi bi-x-circle"></i> –û—Ç–º–µ–Ω–∞
                            </a>
                            <button type="submit" class="btn btn-success btn-lg" id="submitBtn" disabled>
                                <i class="bi bi-check-circle"></i> –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –∑–¥–∞–Ω–∏–µ
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="col-md-4 mb-4">
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–≥—Ä–æ–∫–µ -->
            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-person"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–≥—Ä–æ–∫–µ</h5>
                </div>
                <div class="card-body" id="playerDetails">
                    <p class="text-muted mb-0">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∏–≥—Ä–æ–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</p>
                </div>
            </div>

            <!-- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∑–¥–∞–Ω–∏–π -->
            <div class="card mb-4">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0"><i class="bi bi-info-circle"></i> –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∑–¥–∞–Ω–∏–π</h5>
                </div>
                <div class="card-body">
                    <div class="accordion" id="buildingAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#factoryInfo">
                                    üè≠ –§–∞–±—Ä–∏–∫–∏
                                </button>
                            </h2>
                            <div id="factoryInfo" class="accordion-collapse collapse show" data-bs-parent="#buildingAccordion">
                                <div class="accordion-body">
                                    <ul class="requirements-list">
                                        <li><i class="bi bi-check-circle text-success"></i> –ü—Ä–æ–∏–∑–≤–æ–¥—è—Ç —Ä–µ—Å—É—Ä—Å—ã</li>
                                        <li><i class="bi bi-check-circle text-success"></i> –¢—Ä–µ–±—É—é—Ç —Ä–∞–±–æ—á–∏—Ö</li>
                                        <li><i class="bi bi-check-circle text-success"></i> –î–æ—Ö–æ–¥: 100-500 ‚ÇΩ/—Ö–æ–¥</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#businessInfo">
                                    üè™ –ë–∏–∑–Ω–µ—Å—ã
                                </button>
                            </h2>
                            <div id="businessInfo" class="accordion-collapse collapse" data-bs-parent="#buildingAccordion">
                                <div class="accordion-body">
                                    <ul class="requirements-list">
                                        <li><i class="bi bi-check-circle text-success"></i> –ü—Ä–∏–Ω–æ—Å—è—Ç –ø—Ä–∏–±—ã–ª—å</li>
                                        <li><i class="bi bi-check-circle text-success"></i> –î–æ—Ö–æ–¥: 50-200 ‚ÇΩ/–º–∏–Ω—É—Ç–∞</li>
                                        <li><i class="bi bi-check-circle text-success"></i> –¢—Ä–µ–±—É—é—Ç —Ç–æ–≤–∞—Ä—ã</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#houseInfo">
                                    üè† –ñ–∏–ª—ã–µ –¥–æ–º–∞
                                </button>
                            </h2>
                            <div id="houseInfo" class="accordion-collapse collapse" data-bs-parent="#buildingAccordion">
                                <div class="accordion-body">
                                    <ul class="requirements-list">
                                        <li><i class="bi bi-check-circle text-success"></i> –£–≤–µ–ª–∏—á–∏–≤–∞—é—Ç –Ω–∞—Å–µ–ª–µ–Ω–∏–µ</li>
                                        <li><i class="bi bi-check-circle text-success"></i> –î–∞—é—Ç —Ä–∞–±–æ—á–∏—Ö</li>
                                        <li><i class="bi bi-check-circle text-success"></i> –í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: 10 —á–µ–ª</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ—Å—Ç—Ä–æ–π–∫–∏ -->
            <div class="card">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0"><i class="bi bi-clock-history"></i> –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ—Å—Ç—Ä–æ–π–∫–∏</h5>
                </div>
                <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                    {% for building in recent_buildings|slice:":10" %}
                    <div class="border-bottom mb-2 pb-2">
                        <div class="d-flex justify-content-between">
                            <div>
                                <strong>{{ building.building_name }}</strong>
                                <br><small class="text-muted">–ò–≥—Ä–æ–∫ #{{ building.owner_id }}</small>
                            </div>
                            <div class="text-end">
                                <span class="badge bg-success">{{ building.cost }} ‚ÇΩ</span>
                                <br><small class="text-muted">{{ building.built_at|time:"H:i" }}</small>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <p class="text-muted text-center mb-0">–ù–µ—Ç –ø–æ—Å—Ç—Ä–æ–µ–∫</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // –≠–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã
    const buildingInput = document.getElementById('{{ form.building.id_for_label }}');
    const playerInput = document.getElementById('{{ form.player_id.id_for_label }}');
    const submitBtn = document.getElementById('submitBtn');
    
    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    const buildingInfo = document.getElementById('buildingInfo');
    const resourcesRequired = document.getElementById('resourcesRequired');
    const selectedBuildingName = document.getElementById('selectedBuildingName');
    const selectedBuildingType = document.getElementById('selectedBuildingType');
    const selectedBuildingPrice = document.getElementById('selectedBuildingPrice');
    const totalCost = document.getElementById('totalCost');
    const playerInfo = document.getElementById('playerInfo');
    const playerDetails = document.getElementById('playerDetails');
    
    // –•—Ä–∞–Ω–∏–ª–∏—â–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∑–¥–∞–Ω–∏—è
    let selectedBuilding = null;
    
    // –§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ –∑–¥–∞–Ω–∏—è
    window.selectBuilding = function(buildingId) {
        // –ù–∞—Ö–æ–¥–∏–º –∫–∞—Ä—Ç–æ—á–∫—É
        const card = document.querySelector(`[data-building-id="${buildingId}"]`);
        
        if (card) {
            // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
            document.querySelectorAll('.building-card').forEach(c => {
                c.classList.remove('selected');
            });
            
            // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É
            card.classList.add('selected');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            selectedBuilding = {
                id: buildingId,
                name: card.dataset.buildingName,
                price: parseFloat(card.dataset.buildingPrice),
                type: card.dataset.buildingType
            };
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ
            buildingInput.value = buildingId;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            updateBuildingInfo();
        }
    };
    
    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–¥–∞–Ω–∏–∏
    function updateBuildingInfo() {
        if (selectedBuilding) {
            buildingInfo.style.display = 'block';
            resourcesRequired.style.display = 'block';
            selectedBuildingName.textContent = selectedBuilding.name;
            selectedBuildingType.textContent = selectedBuilding.type;
            selectedBuildingPrice.textContent = selectedBuilding.price.toFixed(2);
            totalCost.textContent = selectedBuilding.price.toFixed(2) + ' ‚ÇΩ';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç—Ä–µ–±—É–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∑–¥–∞–Ω–∏—è
            if (selectedBuilding.type === 'factory') {
                document.getElementById('woodRequired').textContent = '200';
                document.getElementById('stoneRequired').textContent = '100';
                document.getElementById('toolsRequired').textContent = '50';
            } else if (selectedBuilding.type === 'business') {
                document.getElementById('woodRequired').textContent = '100';
                document.getElementById('stoneRequired').textContent = '50';
                document.getElementById('toolsRequired').textContent = '30';
            } else {
                document.getElementById('woodRequired').textContent = '50';
                document.getElementById('stoneRequired').textContent = '25';
                document.getElementById('toolsRequired').textContent = '10';
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ—Å—Ç—Ä–æ–π–∫–∏
            checkBuildPossibility();
        } else {
            buildingInfo.style.display = 'none';
            resourcesRequired.style.display = 'none';
            totalCost.textContent = '0 ‚ÇΩ';
            submitBtn.disabled = true;
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–≥—Ä–æ–∫–∞
    function checkPlayer() {
        const playerId = playerInput.value.trim();
        
        if (playerId) {
            // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å AJAX –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–≥—Ä–æ–∫–∞
            playerInfo.innerHTML = `<span class="text-success">‚úì –ò–≥—Ä–æ–∫ #${playerId} –Ω–∞–π–¥–µ–Ω</span>`;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–≥—Ä–æ–∫–µ
            playerDetails.innerHTML = `
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <i class="bi bi-person-circle fs-1"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6>–ò–≥—Ä–æ–∫ #${playerId}</h6>
                        <p class="mb-1"><i class="bi bi-building"></i> –ü–æ—Å—Ç—Ä–æ–µ–∫: 0</p>
                        <p class="mb-1"><i class="bi bi-cash"></i> –ë–∞–ª–∞–Ω—Å: 10,000 ‚ÇΩ</p>
                        <small class="text-muted">–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: —Å–µ–≥–æ–¥–Ω—è</small>
                    </div>
                </div>
            `;
            
            checkBuildPossibility();
        } else {
            playerInfo.innerHTML = '';
            playerDetails.innerHTML = '<p class="text-muted mb-0">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∏–≥—Ä–æ–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</p>';
            submitBtn.disabled = true;
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ—Å—Ç—Ä–æ–π–∫–∏
    function checkBuildPossibility() {
        const playerId = playerInput.value.trim();
        
        if (selectedBuilding && playerId) {
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–ª–∏—á–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
            submitBtn.disabled = false;
        } else {
            submitBtn.disabled = true;
        }
    }
    
    // –°–æ–±—ã—Ç–∏—è
    document.getElementById('checkPlayerBtn').addEventListener('click', checkPlayer);
    playerInput.addEventListener('blur', checkPlayer);
    playerInput.addEventListener('input', function() {
        if (!this.value) {
            playerInfo.innerHTML = '';
            playerDetails.innerHTML = '<p class="text-muted mb-0">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∏–≥—Ä–æ–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</p>';
            submitBtn.disabled = true;
        }
    });
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    if (buildingInput.value) {
        selectBuilding(buildingInput.value);
    }
});
</script>
{% endblock %}
