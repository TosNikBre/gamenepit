{% extends 'base.html' %}

{% block title %}–ü–æ–∫—É–ø–∫–∞ —Ä–µ—Å—É—Ä—Å–∞ - –û—Å—Ç—Ä–æ–≤{% endblock %}

{% block extra_css %}
<style>
    .resource-card {
        transition: all 0.3s;
        cursor: pointer;
        border: 2px solid transparent;
        height: 100%;
    }
    .resource-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }
    .resource-card.selected {
        border-color: #28a745;
        background-color: #f0fff0;
    }
    .resource-icon {
        font-size: 48px;
        margin-bottom: 15px;
    }
    .price-tag {
        font-size: 1.5rem;
        font-weight: bold;
        color: #28a745;
    }
    .stock-badge {
        background: #e9ecef;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.9rem;
    }
    .total-price {
        font-size: 2rem;
        font-weight: bold;
        color: #007bff;
        animation: pulse 2s infinite;
    }
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
    .market-info {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
    }
    .resource-row {
        display: flex;
        justify-content: space-between;
        padding: 10px;
        border-bottom: 1px solid #dee2e6;
    }
    .resource-row:last-child {
        border-bottom: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <div class="d-flex justify-content-between align-items-center">
            <h2><i class="bi bi-basket"></i> –ü–æ–∫—É–ø–∫–∞ —Ä–µ—Å—É—Ä—Å–∞</h2>
            <div>
                
                <a href="{% url 'island_dashboard' %}" class="btn btn-sm btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥
                </a>
            </div>
        </div>
        <p class="text-muted">–ü—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</p>
    </div>

    <!-- –†—ã–Ω–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="market-info mb-4">
        <div class="row">
            <div class="col-md-4 text-center">
                <h3>{{ resources_count|default:'4' }}</h3>
                <small>–î–æ—Å—Ç—É–ø–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤</small>
            </div>
            <div class="col-md-4 text-center">
                <h3>{{ today_sales|default:'0' }}</h3>
                <small>–ü—Ä–æ–¥–∞–∂ —Å–µ–≥–æ–¥–Ω—è</small>
            </div>
            <div class="col-md-4 text-center">
                <h3>{{ total_revenue|default:'0' }} ‚ÇΩ</h3>
                <small>–í—ã—Ä—É—á–∫–∞ –∑–∞ –¥–µ–Ω—å</small>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- –§–æ—Ä–º–∞ –ø–æ–∫—É–ø–∫–∏ -->
        <div class="col-md-7 mb-4">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-cart"></i> –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏</h5>
                </div>
                <div class="card-body">
                    <form method="post" id="purchaseForm" novalidate>
                        {% csrf_token %}
                        
                        {% if form.non_field_errors %}
                            <div class="alert alert-danger">
                                {% for error in form.non_field_errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}

                        <!-- –í—ã–±–æ—Ä —Ä–µ—Å—É—Ä—Å–∞ (–≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏) -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ—Å—É—Ä—Å <span class="text-danger">*</span></label>
                            
                            {% if resources %}
                            <div class="row" id="resourceCards">
                                {% for resource in resources %}
                                <div class="col-md-6 mb-3">
                                    <div class="card resource-card" 
                                         data-resource-id="{{ resource.id }}"
                                         data-resource-name="{{ resource.name }}"
                                         data-resource-price="{{ resource.base_price }}"
                                         onclick="selectResource('{{ resource.id }}', '{{ resource.name }}', {{ resource.base_price }})">
                                        <div class="card-body text-center">
                                            <div class="resource-icon">
                                                {% if '–∫–æ—Ñ' in resource.name|lower %}
                                                    ‚òï
                                                {% elif '–∫–∞–∫–∞–æ' in resource.name|lower %}
                                                    üç´
                                                {% elif '—Ç–∞–±–∞–∫' in resource.name|lower %}
                                                    üö¨
                                                {% elif '—Ç—Ä–æ—Å—Ç–Ω–∏–∫' in resource.name|lower %}
                                                    üéã
                                                {% elif '–¥—Ä–µ–≤' in resource.name|lower %}
                                                    üå≤
                                                {% elif '–∫–∞–º–µ–Ω—å' in resource.name|lower %}
                                                    ü™®
                                                {% elif '–∂–µ–ª–µ–∑' in resource.name|lower %}
                                                    ‚öíÔ∏è
                                                {% elif '—É–≥–æ–ª—å' in resource.name|lower %}
                                                    ‚ö´
                                                {% elif '—Ö–ª–æ–ø–æ–∫' in resource.name|lower %}
                                                    üåø
                                                {% else %}
                                                    üì¶
                                                {% endif %}
                                            </div>
                                            <h6>{{ resource.name }}</h6>
                                            <div class="price-tag">{{ resource.base_price }} ‚ÇΩ</div>
                                            <div class="mt-2">
                                                <span class="stock-badge">
                                                    <i class="bi bi-box"></i> –≤ –Ω–∞–ª–∏—á–∏–∏
                                                </span>
                                            </div>
                                            <small class="text-muted d-block mt-2">{{ resource.description|truncatechars:50 }}</small>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            {% else %}
                            <div class="alert alert-warning">
                                <i class="bi bi-exclamation-triangle"></i>
                                –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏.
                                <br>–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É: <code>python manage.py init_prices</code>
                                <br>–∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ —Ä–µ—Å—É—Ä—Å—ã —á–µ—Ä–µ–∑ <a href="/admin/munepit/pricelist/" target="_blank">–∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>.
                            </div>
                            {% endif %}
                            
                            <input type="hidden" name="{{ form.resource.name }}" id="{{ form.resource.id_for_label }}" value="{{ form.resource.value|default:'' }}">
                            {% if form.resource.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.resource.errors.0 }}
                                </div>
                            {% endif %}
                        </div>

                        <!-- –ù–æ–º–µ—Ä –∏–≥—Ä–æ–∫–∞ -->
                        <div class="mb-4">
                            <label for="{{ form.player_id.id_for_label }}" class="form-label fw-bold">
                                {{ form.player_id.label }} <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">#</span>
                                <input type="text" 
                                       name="{{ form.player_id.name }}"
                                       id="{{ form.player_id.id_for_label }}"
                                       class="form-control form-control-lg {% if form.player_id.errors %}is-invalid{% endif %}"
                                       value="{{ form.player_id.value|default:'' }}"
                                       placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∏–≥—Ä–æ–∫–∞"
                                       required>
                                <button class="btn btn-outline-secondary" type="button" id="checkPlayerBtn">
                                    <i class="bi bi-search"></i>
                                </button>
                            </div>
                            {% if form.player_id.errors %}
                                <div class="invalid-feedback">
                                    {{ form.player_id.errors.0 }}
                                </div>
                            {% endif %}
                            <div class="form-text" id="playerInfo"></div>
                        </div>

                        <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ -->
                        <div class="mb-4">
                            <label for="{{ form.quantity.id_for_label }}" class="form-label fw-bold">
                                {{ form.quantity.label }} <span class="text-danger">*</span>
                            </label>
                            <input type="number" 
                                   name="{{ form.quantity.name }}"
                                   id="{{ form.quantity.id_for_label }}"
                                   class="form-control form-control-lg {% if form.quantity.errors %}is-invalid{% endif %}"
                                   value="{{ form.quantity.value|default:'1' }}"
                                   min="1"
                                   max="1000"
                                   step="1"
                                   {% if not resources %}disabled{% endif %}
                                   required>
                            {% if form.quantity.errors %}
                                <div class="invalid-feedback">
                                    {{ form.quantity.errors.0 }}
                                </div>
                            {% endif %}
                            <div class="form-text">–ú–∞–∫—Å–∏–º—É–º: 1000 –µ–¥–∏–Ω–∏—Ü –∑–∞ —Ä–∞–∑</div>
                        </div>

                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–∫—É–ø–∫–µ -->
                        <div class="card bg-light mb-4" id="purchaseInfo" style="display: none;">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>–í—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–µ—Å—É—Ä—Å:</h6>
                                        <h4 id="selectedResourceName">‚Äî</h4>
                                        <p class="mb-1">–¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É: <strong id="selectedResourcePrice">0</strong> ‚ÇΩ</p>
                                    </div>
                                    <div class="col-md-6 text-center">
                                        <div class="total-price" id="totalCost">0 ‚ÇΩ</div>
                                        <p class="mb-0">–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –í–Ω–µ—Å–µ–Ω–æ –¥–µ–Ω–µ–≥ -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">–í–Ω–µ—Å–µ–Ω–æ –¥–µ–Ω–µ–≥ <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <input type="number" 
                                       id="moneyInput"
                                       class="form-control form-control-lg"
                                       step="0.01"
                                       min="0"
                                       placeholder="0.00"
                                       {% if not resources %}disabled{% endif %}
                                       required>
                                <span class="input-group-text">‚ÇΩ</span>
                            </div>
                        </div>

                        <!-- –ë–ª–æ–∫ —Å–¥–∞—á–∏ -->
                        <div class="card bg-success text-white mb-4" id="changeBlock" style="display: none;">
                            <div class="card-body">
                                <h5 class="mb-0">–°–¥–∞—á–∞: <span id="changeAmount">0.00</span> ‚ÇΩ</h5>
                            </div>
                        </div>

                        <!-- –ë–ª–æ–∫ –æ—à–∏–±–∫–∏ -->
                        <div class="alert alert-danger mb-4" id="errorBlock" style="display: none;">
                            <i class="bi bi-exclamation-triangle"></i> 
                            –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤! –¢—Ä–µ–±—É–µ—Ç—Å—è: <span id="requiredAmount">0.00</span> ‚ÇΩ
                        </div>

                        <!-- –ö–Ω–æ–ø–∫–∏ -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{% url 'island_dashboard' %}" class="btn btn-secondary btn-lg me-md-2">
                                <i class="bi bi-x-circle"></i> –û—Ç–º–µ–Ω–∞
                            </a>
                            <button type="submit" class="btn btn-success btn-lg" id="submitBtn" {% if not resources %}disabled{% endif %}>
                                <i class="bi bi-check-circle"></i> –ö—É–ø–∏—Ç—å
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="col-md-5 mb-4">
            <!-- –ü—Ä–∞–π—Å-–ª–∏—Å—Ç -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-list"></i> –ü—Ä–∞–π—Å-–ª–∏—Å—Ç</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>–†–µ—Å—É—Ä—Å</th>
                                    <th>–¶–µ–Ω–∞</th>
                                    <th>–î–æ—Å—Ç—É–ø–Ω–æ</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for resource in resources %}
                                <tr>
                                    <td>
                                        {% if '–∫–æ—Ñ' in resource.name|lower %}‚òï{% endif %}
                                        {% if '–∫–∞–∫–∞–æ' in resource.name|lower %}üç´{% endif %}
                                        {% if '—Ç–∞–±–∞–∫' in resource.name|lower %}üö¨{% endif %}
                                        {% if '—Ç—Ä–æ—Å—Ç–Ω–∏–∫' in resource.name|lower %}üéã{% endif %}
                                        {% if '–¥—Ä–µ–≤' in resource.name|lower %}üå≤{% endif %}
                                        {% if '–∫–∞–º–µ–Ω—å' in resource.name|lower %}ü™®{% endif %}
                                        {{ resource.name }}
                                    </td>
                                    <td><span class="badge bg-success">{{ resource.base_price }} ‚ÇΩ</span></td>
                                    <td><span class="badge bg-info">‚àû</span></td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="3" class="text-center text-muted">
                                        –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–≥—Ä–æ–∫–µ -->
            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-person"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–≥—Ä–æ–∫–µ</h5>
                </div>
                <div class="card-body" id="playerDetails">
                    <p class="text-muted mb-0">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∏–≥—Ä–æ–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</p>
                </div>
            </div>

            <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏ -->
            <div class="card">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0"><i class="bi bi-clock-history"></i> –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏</h5>
                </div>
                <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                    {% for purchase in recent_purchases|slice:":10" %}
                    <div class="border-bottom mb-2 pb-2">
                        <div class="d-flex justify-content-between">
                            <div>
                                <strong>–ò–≥—Ä–æ–∫ #{{ purchase.player_id }}</strong>
                                <br><small class="text-muted">{{ purchase.resource }}</small>
                            </div>
                            <div class="text-end">
                                <span class="badge bg-success">{{ purchase.amount }} ‚ÇΩ</span>
                                <br><small class="text-muted">{{ purchase.timestamp|time:"H:i" }}</small>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <p class="text-muted text-center mb-0">–ù–µ—Ç –ø–æ–∫—É–ø–æ–∫</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // –≠–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã
    const resourceInput = document.getElementById('{{ form.resource.id_for_label }}');
    const playerInput = document.getElementById('{{ form.player_id.id_for_label }}');
    const quantityInput = document.getElementById('{{ form.quantity.id_for_label }}');
    const moneyInput = document.getElementById('moneyInput');
    const submitBtn = document.getElementById('submitBtn');
    
    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    const purchaseInfo = document.getElementById('purchaseInfo');
    const selectedResourceName = document.getElementById('selectedResourceName');
    const selectedResourcePrice = document.getElementById('selectedResourcePrice');
    const totalCost = document.getElementById('totalCost');
    const playerInfo = document.getElementById('playerInfo');
    const playerDetails = document.getElementById('playerDetails');
    const changeBlock = document.getElementById('changeBlock');
    const changeAmount = document.getElementById('changeAmount');
    const errorBlock = document.getElementById('errorBlock');
    const requiredAmount = document.getElementById('requiredAmount');

    let currentResource = null;
    let currentPrice = 0;

    // –§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Ä–µ—Å—É—Ä—Å–∞
    window.selectResource = function(resourceId, resourceName, resourcePrice) {
        // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
        document.querySelectorAll('.resource-card').forEach(c => {
            c.classList.remove('selected');
        });
        
        // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É
        const selectedCard = document.querySelector(`[data-resource-id="${resourceId}"]`);
        if (selectedCard) {
            selectedCard.classList.add('selected');
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
        currentResource = resourceId;
        currentPrice = resourcePrice;
        resourceInput.value = resourceId;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        purchaseInfo.style.display = 'block';
        selectedResourceName.textContent = resourceName;
        selectedResourcePrice.textContent = resourcePrice.toFixed(2);
        
        updateTotal();
    };

    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
    function updateTotal() {
        const quantity = parseInt(quantityInput.value) || 0;
        
        if (currentResource && quantity > 0) {
            const total = currentPrice * quantity;
            totalCost.textContent = total.toFixed(2) + ' ‚ÇΩ';
            checkFunds(total);
        } else {
            totalCost.textContent = '0 ‚ÇΩ';
            changeBlock.style.display = 'none';
            errorBlock.style.display = 'none';
            submitBtn.disabled = true;
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤
    function checkFunds(required) {
        const money = parseFloat(moneyInput.value) || 0;
        
        if (money >= required) {
            const change = money - required;
            changeAmount.textContent = change.toFixed(2);
            changeBlock.style.display = 'block';
            errorBlock.style.display = 'none';
            submitBtn.disabled = false;
        } else {
            changeBlock.style.display = 'none';
            errorBlock.style.display = 'block';
            requiredAmount.textContent = required.toFixed(2);
            submitBtn.disabled = true;
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–≥—Ä–æ–∫–∞
    function checkPlayer() {
        const playerId = playerInput.value.trim();
        
        if (playerId) {
            playerInfo.innerHTML = `<span class="text-success">‚úì –ò–≥—Ä–æ–∫ #${playerId} –Ω–∞–π–¥–µ–Ω</span>`;
            
            playerDetails.innerHTML = `
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <i class="bi bi-person-circle fs-1"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6>–ò–≥—Ä–æ–∫ #${playerId}</h6>
                        <p class="mb-1"><i class="bi bi-cash"></i> –ë–∞–ª–∞–Ω—Å: 10,000 ‚ÇΩ</p>
                        <p class="mb-1"><i class="bi bi-box"></i> –†–µ—Å—É—Ä—Å–æ–≤: 1,200 –µ–¥.</p>
                        <small class="text-muted">–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: —Å–µ–≥–æ–¥–Ω—è</small>
                    </div>
                </div>
            `;
        } else {
            playerInfo.innerHTML = '';
            playerDetails.innerHTML = '<p class="text-muted mb-0">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∏–≥—Ä–æ–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</p>';
        }
    }

    // –°–æ–±—ã—Ç–∏—è
    quantityInput.addEventListener('input', updateTotal);
    moneyInput.addEventListener('input', function() {
        if (currentResource) {
            const quantity = parseInt(quantityInput.value) || 0;
            const total = currentPrice * quantity;
            checkFunds(total);
        }
    });
    
    document.getElementById('checkPlayerBtn').addEventListener('click', checkPlayer);
    playerInput.addEventListener('blur', checkPlayer);

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    {% if form.resource.value %}
        // –ù–∞–π—Ç–∏ —Ä–µ—Å—É—Ä—Å –ø–æ ID –∏ –≤—ã–±—Ä–∞—Ç—å –µ–≥–æ
        const resourceId = '{{ form.resource.value }}';
        const resourceCard = document.querySelector(`[data-resource-id="${resourceId}"]`);
        if (resourceCard) {
            selectResource(
                resourceId,
                resourceCard.dataset.resourceName,
                parseFloat(resourceCard.dataset.resourcePrice)
            );
        }
    {% endif %}
    
    {% if form.player_id.value %}
        playerInput.value = '{{ form.player_id.value }}';
        checkPlayer();
    {% endif %}
});
</script>
{% endblock %}